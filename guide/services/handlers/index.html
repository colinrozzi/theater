<!DOCTYPE HTML>
<html lang="en" class="light sidebar-visible" dir="ltr">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title>Handler System - Theater Docs</title>


        <!-- Custom HTML head -->

        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff">

        <link rel="icon" href="../../favicon.svg">
        <link rel="shortcut icon" href="../../favicon.png">
        <link rel="stylesheet" href="../../css/variables.css">
        <link rel="stylesheet" href="../../css/general.css">
        <link rel="stylesheet" href="../../css/chrome.css">
        <link rel="stylesheet" href="../../css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="../../FontAwesome/css/font-awesome.css">
        <link rel="stylesheet" href="../../fonts/fonts.css">

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" id="highlight-css" href="../../highlight.css">
        <link rel="stylesheet" id="tomorrow-night-css" href="../../tomorrow-night.css">
        <link rel="stylesheet" id="ayu-highlight-css" href="../../ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        <link rel="stylesheet" href="../../css/custom.css">


        <!-- Provide site root and default themes to javascript -->
        <script>
            const path_to_root = "../../";
            const default_light_theme = "light";
            const default_dark_theme = "navy";
            window.path_to_searchindex_js = "../../searchindex.js";
        </script>
        <!-- Start loading toc.js asap -->
        <script src="../../toc.js"></script>
    </head>
    <body>
    <div id="mdbook-help-container">
        <div id="mdbook-help-popup">
            <h2 class="mdbook-help-title">Keyboard shortcuts</h2>
            <div>
                <p>Press <kbd>←</kbd> or <kbd>→</kbd> to navigate between chapters</p>
                <p>Press <kbd>S</kbd> or <kbd>/</kbd> to search in the book</p>
                <p>Press <kbd>?</kbd> to show this help</p>
                <p>Press <kbd>Esc</kbd> to hide this help</p>
            </div>
        </div>
    </div>
    <div id="body-container">
        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script>
            try {
                let theme = localStorage.getItem('mdbook-theme');
                let sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script>
            const default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? default_dark_theme : default_light_theme;
            let theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            const html = document.documentElement;
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add("js");
        </script>

        <input type="checkbox" id="sidebar-toggle-anchor" class="hidden">

        <!-- Hide / unhide sidebar before it is displayed -->
        <script>
            let sidebar = null;
            const sidebar_toggle = document.getElementById("sidebar-toggle-anchor");
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            } else {
                sidebar = 'hidden';
                sidebar_toggle.checked = false;
            }
            if (sidebar === 'visible') {
                sidebar_toggle.checked = true;
            } else {
                html.classList.remove('sidebar-visible');
            }
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <!-- populated by js -->
            <mdbook-sidebar-scrollbox class="sidebar-scrollbox"></mdbook-sidebar-scrollbox>
            <noscript>
                <iframe class="sidebar-iframe-outer" src="../../toc.html"></iframe>
            </noscript>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle">
                <div class="sidebar-resize-indicator"></div>
            </div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky">
                    <div class="left-buttons">
                        <label id="sidebar-toggle" class="icon-button" for="sidebar-toggle-anchor" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </label>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="default_theme">Auto</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="light">Light</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        <button id="search-toggle" class="icon-button" type="button" title="Search (`/`)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="/ s" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                    </div>

                    <h1 class="menu-title">Theater Docs</h1>

                    <div class="right-buttons">
                        <a href="../../print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        <a href="https://github.com/colinrozzi/theater" title="Git repository" aria-label="Git repository">
                            <i id="git-repository-button" class="fa fa-github"></i>
                        </a>
                        <a href="https://github.com/colinrozzi/theater/edit/main/book/src/services/handlers/README.md" title="Suggest an edit" aria-label="Suggest an edit" rel="edit">
                            <i id="git-edit-button" class="fa fa-edit"></i>
                        </a>

                    </div>
                </div>

                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <div class="search-wrapper">
                            <input type="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                            <div class="spinner-wrapper">
                                <i class="fa fa-spinner fa-spin"></i>
                            </div>
                        </div>
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script>
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1 id="handler-system"><a class="header" href="#handler-system">Handler System</a></h1>
<p>The handler system is the core of how actors interact with the outside world and with each other in Theater. Handlers provide the bridge between WebAssembly actors and host capabilities, enabling actors to send messages, access resources, and participate in supervision hierarchies.</p>
<h2 id="what-are-handlers"><a class="header" href="#what-are-handlers">What Are Handlers?</a></h2>
<p>Handlers are specialized components that:</p>
<ol>
<li><strong>Connect Actors with Host Capabilities</strong>: Handlers expose host functions to WebAssembly actors, allowing them to interact with the host system and other actors</li>
<li><strong>Process Messages and Events</strong>: Handlers receive and process incoming messages, translating them into actor function calls</li>
<li><strong>Maintain Chain Integrity</strong>: All handler operations are recorded in the actor's chain, maintaining the verifiable history</li>
<li><strong>Provide Standard Interfaces</strong>: Handlers implement standard WebAssembly Interface Type (WIT) interfaces, ensuring consistency across actors</li>
</ol>
<h2 id="handler-architecture"><a class="header" href="#handler-architecture">Handler Architecture</a></h2>
<p>Each handler consists of two main parts:</p>
<ol>
<li>
<p><strong>Host Functions</strong> (Imports): Functions provided by the host environment that actors can call. These are integrated into the actor's WebAssembly module during instantiation.</p>
</li>
<li>
<p><strong>Exported Functions</strong> (Exports): Functions that the actor implements and the handler calls in response to external events or messages.</p>
</li>
</ol>
<p>This bidirectional interface allows for complete interaction patterns while maintaining the security boundaries provided by WebAssembly.</p>
<h2 id="handler-lifecycle"><a class="header" href="#handler-lifecycle">Handler Lifecycle</a></h2>
<p>When an actor is started:</p>
<ol>
<li><strong>Registration</strong>: Handlers specified in the actor's manifest are registered with the actor runtime</li>
<li><strong>Initialization</strong>: Each handler is initialized and connected to the actor component</li>
<li><strong>Host Function Setup</strong>: The handler adds its host functions to the actor's WebAssembly linker</li>
<li><strong>Export Function Registration</strong>: The handler registers the actor's exported functions for callbacks</li>
<li><strong>Start</strong>: The handler's event loop is started in a separate task</li>
</ol>
<p>During operation:</p>
<ol>
<li><strong>Message Processing</strong>: Handlers receive messages or events and process them</li>
<li><strong>Function Calls</strong>: Handlers call actor functions or respond to actor requests to host functions</li>
<li><strong>State Recording</strong>: All interactions are recorded in the actor's state chain</li>
</ol>
<p>During shutdown:</p>
<ol>
<li><strong>Graceful Termination</strong>: Handlers receive shutdown signals and perform cleanup</li>
<li><strong>Resource Release</strong>: All resources owned by handlers are released</li>
</ol>
<h2 id="handler-configuration"><a class="header" href="#handler-configuration">Handler Configuration</a></h2>
<p>Handlers are configured in the actor's manifest file (TOML format):</p>
<pre><code class="language-toml">name = "my-actor"
component_path = "my_actor.wasm"

[[handlers]]
type = "message-server"
config = {}

[[handlers]]
type = "http-client"
config = {}

[[handlers]]
type = "filesystem"
config = { new_dir = true }
</code></pre>
<p>Each handler entry includes:</p>
<ul>
<li><code>type</code>: The handler type identifier</li>
<li><code>config</code>: Handler-specific configuration options</li>
</ul>
<h2 id="available-handler-types"><a class="header" href="#available-handler-types">Available Handler Types</a></h2>
<p>Theater provides several built-in handler types:</p>
<ol>
<li><strong>message-server</strong>: Enables actor-to-actor messaging using both synchronous (request/response) and asynchronous (fire-and-forget) patterns</li>
<li><strong>http-client</strong>: Allows actors to make HTTP requests to external services</li>
<li><strong>http-framework</strong>: Exposes actor functionality via HTTP endpoints</li>
<li><strong>filesystem</strong>: Provides access to the filesystem with appropriate sandboxing</li>
<li><strong>supervisor</strong>: Enables parent-child actor relationships for supervision</li>
<li><strong>store</strong>: Provides content-addressable storage for actors</li>
<li><strong>runtime</strong>: Gives access to runtime information and operations</li>
<li><strong>timing</strong>: Provides timing and scheduling capabilities</li>
</ol>
<h2 id="webassembly-interface-types-wit"><a class="header" href="#webassembly-interface-types-wit">WebAssembly Interface Types (WIT)</a></h2>
<p>Handler abilitiesare exposed to the actors using WebAssembly Interface Types (WIT), which provide a language-agnostic way to describe component interfaces. For example, the message-server interface is defined as:</p>
<pre><code class="language-wit">interface message-server-client {
    use types.{json, event};

    handle-send: func(state: option&lt;json&gt;, params: tuple&lt;json&gt;) -&gt; result&lt;tuple&lt;option&lt;json&gt;&gt;, string&gt;;
    handle-request: func(state: option&lt;json&gt;, params: tuple&lt;json&gt;) -&gt; result&lt;tuple&lt;option&lt;json&gt;, tuple&lt;json&gt;&gt;, string&gt;;
}

interface message-server-host {
    use types.{json, actor-id};

    send: func(actor-id: actor-id, msg: json) -&gt; result&lt;_, string&gt;;
    request: func(actor-id: actor-id, msg: json) -&gt; result&lt;json, string&gt;;
}
</code></pre>
<h2 id="handler-implementation-details"><a class="header" href="#handler-implementation-details">Handler Implementation Details</a></h2>
<p>Under the hood, handlers are implemented as Rust structs that:</p>
<ol>
<li>Implement the <code>Handler</code> trait</li>
<li>Handle setup of host functions</li>
<li>Process messages and events</li>
<li>Call actor functions when needed</li>
<li>Maintain appropriate state</li>
</ol>
<p>For example, the <code>MessageServerHost</code> implements handler functionality for actor-to-actor messaging.</p>
<h2 id="handler-security-model"><a class="header" href="#handler-security-model">Handler Security Model</a></h2>
<p>The handler system is designed with security in mind:</p>
<ol>
<li><strong>Sandboxed Access</strong>: Handlers provide controlled access to host resources</li>
<li><strong>Verifiable State</strong>: All handler operations are recorded in the chain</li>
<li><strong>Explicit Permissions</strong>: Actors must explicitly declare which handlers they use</li>
</ol>
<h2 id="developing-custom-handlers"><a class="header" href="#developing-custom-handlers">Developing Custom Handlers</a></h2>
<p>To develop a new handler for Theater:</p>
<ol>
<li><strong>Define the WIT Interface</strong>: Create a new <code>.wit</code> file defining the interface</li>
<li><strong>Implement the Handler</strong>: Create a new handler implementation in Rust</li>
<li><strong>Register the Handler</strong>: Add the handler to the configuration system</li>
<li><strong>Connect to Actor Runtime</strong>: Integrate the handler with the actor runtime</li>
</ol>
<h2 id="best-practices"><a class="header" href="#best-practices">Best Practices</a></h2>
<ol>
<li><strong>Handler Selection</strong>: Only include handlers that your actor actually needs</li>
<li><strong>Resource Management</strong>: Configure appropriate resource limits for handlers</li>
<li><strong>Error Handling</strong>: Implement proper error handling for handler operations</li>
<li><strong>Testing</strong>: Test handlers in isolation before integrating them</li>
</ol>
<h2 id="next-steps"><a class="header" href="#next-steps">Next Steps</a></h2>
<p>In the following sections, we'll explore each handler type in detail, including:</p>
<ul>
<li>Specific configuration options</li>
<li>Available functions</li>
<li>Usage patterns</li>
<li>Examples</li>
</ul>
<p>See the individual handler documentation for more details:</p>
<ul>
<li><a href="message-server.html">Message Server Handler</a></li>
<li><a href="http-client.html">HTTP Client Handler</a></li>
<li><a href="http-framework.html">HTTP Framework Handler</a></li>
<li><a href="filesystem.html">File System Handler</a></li>
<li><a href="supervisor.html">Supervisor Handler</a></li>
<li><a href="store.html">Store Handler</a></li>
<li><a href="runtime.html">Runtime Handler</a></li>
<li><a href="timing.html">Timing Handler</a></li>
</ul>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                            <a rel="prev" href="../../services/handlers.html" class="mobile-nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                                <i class="fa fa-angle-left"></i>
                            </a>

                            <a rel="next prefetch" href="../../services/handlers/message-server.html" class="mobile-nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                                <i class="fa fa-angle-right"></i>
                            </a>

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                    <a rel="prev" href="../../services/handlers.html" class="nav-chapters previous" title="Previous chapter" aria-label="Previous chapter" aria-keyshortcuts="Left">
                        <i class="fa fa-angle-left"></i>
                    </a>

                    <a rel="next prefetch" href="../../services/handlers/message-server.html" class="nav-chapters next" title="Next chapter" aria-label="Next chapter" aria-keyshortcuts="Right">
                        <i class="fa fa-angle-right"></i>
                    </a>
            </nav>

        </div>




        <script>
            window.playground_copyable = true;
        </script>


        <script src="../../elasticlunr.min.js"></script>
        <script src="../../mark.min.js"></script>
        <script src="../../searcher.js"></script>

        <script src="../../clipboard.min.js"></script>
        <script src="../../highlight.js"></script>
        <script src="../../book.js"></script>

        <!-- Custom JS scripts -->



    </div>
    </body>
</html>
