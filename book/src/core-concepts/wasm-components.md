# WebAssembly Components & Sandboxing

WebAssembly (Wasm) Components form the foundational pillar for Theater's security, isolation, and determinism. By leveraging the Wasm Component Model, Theater creates sandboxed environments where actors can execute predictably and securely, regardless of their origin or the language they were written in.

## The Power of WebAssembly for Secure Execution

WebAssembly was designed with security as a primary goal. It provides several key features that Theater utilizes:

1.  **Strong Sandboxing**: Each Wasm component runs in a completely isolated memory space. It cannot access the host system's resources (like files, network, or environment variables) or the memory of other components unless explicitly granted permission via specific imported functions.
2.  **Limited Instruction Set**: Wasm's instruction set is intentionally minimal and well-defined. For example, it lacks arbitrary jump instructions, which eliminates entire classes of vulnerabilities common in native code execution.
3.  **Capability-Based Security**: The Wasm Component Model relies on explicit interfaces defined using the WebAssembly Interface Type (WIT) language. Components declare the functions they export and the functions they need to import (capabilities). Theater acts as the host, controlling which capabilities (like accessing specific system services or communicating with other actors) are provided to each component instance (actor).

This sandboxed, capability-based approach means that even untrusted code, such as code generated by AI, can be executed with strong security guarantees. Theater confines the code's operation, limiting its potential impact.

## Deterministic Execution for Predictability

A crucial property Theater gains from WebAssembly is deterministic execution at the function level. Given the same inputs, a Wasm function will always produce the same outputs and side effects *within the sandbox*.

-   **Well-Defined Semantics**: Wasm has rigorously defined behavior, avoiding the ambiguities and undefined behaviors found in languages like C or C++.
-   **Controlled Environment**: All interactions with the outside world (beyond pure computation) must go through imported host functions, which Theater controls.

This determinism is essential for Theater's [Traceability & Verification](./traceability.md) pillar, enabling reliable replay, debugging, and state verification.

## Language Agnosticism and Composition

WebAssembly serves as a portable compilation target for numerous programming languages (Rust, C/C++, Go, AssemblyScript, C#, and more). The Wasm Component Model further enhances this by allowing components written in different languages to interoperate seamlessly.

-   **Write Actors in Your Preferred Language**: Developers can choose the best language for their specific task.
-   **Compose Diverse Components**: An actor within Theater might itself be composed of multiple Wasm components, potentially written in different languages, communicating through their defined WIT interfaces.
-   **Consistent Runtime**: Regardless of the source language, the compiled Wasm component behaves predictably within the Theater runtime.

While the Component Model is still evolving across the ecosystem (with Rust having the most mature tooling currently), it provides a powerful, standardized way to build modular and interoperable actors.

## Interface Definitions with WIT

Theater uses the WebAssembly Interface Type (WIT) language to define the contracts between actors and the system:

-   **Actor Interfaces**: Specifies the functions an actor exposes to be called by Theater or other actors.
-   **Host Functions**: Defines the capabilities the Theater runtime provides *to* actors (e.g., sending messages, accessing state storage, interacting with system services).
-   **Data Formats**: Describes the structure and types of data (like messages) exchanged between actors and the host.

These explicit interface definitions ensure clarity about what interactions are possible and enforce the capability-based security model.

## Benefits for Theater

By building upon WebAssembly Components, Theater achieves:

1.  **Strong Isolation**: Preventing actors from interfering with each other or the host system.
2.  **Enhanced Security**: Minimizing the attack surface by restricting capabilities.
3.  **Execution Determinism**: Enabling reliable replay, verification, and debugging.
4.  **Language Flexibility**: Allowing actors to be developed in various languages.
5.  **Modularity and Composability**: Facilitating the creation of complex actors from smaller, reusable parts.
6.  **Portability**: Ensuring actors can run consistently across different environments supporting Wasm.

This foundation allows Theater to provide a robust runtime environment capable of managing potentially untrusted or complex code with confidence.
